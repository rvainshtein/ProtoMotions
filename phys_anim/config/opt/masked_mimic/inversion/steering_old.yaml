# @package _global_

env:
  _target_: phys_anim.envs.masked_mimic_inversion.steering.${backbone}.MaskedMimicDirectionHumanoid
#  _target_: phys_anim.envs.masked_mimic.tasks.steering.${backbone}.MaskedMimicSteeringHumanoid
  config:
    steering_params:
      heading_change_steps_min: 40
      heading_change_steps_max: 150
      random_heading_probability: 0.2
      standard_heading_change: 1.57
#      tar_speed_min: 1.2
      tar_speed_min: 4
      tar_speed_max: 6
      change_steps_min: 199
      change_steps_max: 200
      standard_speed_change: 0.3
      stop_probability: 0.05
      enable_rand_heading: True
      obs_size: 3
      log_speed: False

algo:
  config:
    models:
      # Append the direction obs to the actor and critic inputs
      direction_model:
        _target_: phys_anim.agents.models.common.Flatten
        config:
          normalize_obs: False
          obs_clamp_value: null
        # Input and output size are the same due to flattening
        num_in: ${env.config.steering_params.obs_size}
        num_out: ${env.config.steering_params.obs_size}

      direction_model_for_transformer:
        _target_: phys_anim.agents.models.mlp.MLP_WithNorm
        config:
          initializer: ${algo.config.actor.config.initializer}
          units: ${algo.config.models.prior_preprocessor_units}
          activation: ${algo.config.actor.config.activation}
          use_layer_norm: ${algo.config.actor.config.use_layer_norm}
          normalize_obs: ${algo.config.normalize_obs}
          obs_clamp_value: ${algo.config.obs_clamp_value}
          encoder_input_dim: ${env.config.steering_params.obs_size}
          operations:
            - type: encode
            - type: reshape
              new_shape:
                - batch_size
                - 1
                - ${algo.config.models.motion_text_embeddings_for_transformer_model.num_out}
        num_in: ${env.config.steering_params.obs_size}
        num_out: ${algo.config.actor.config.mu_model.config.transformer_token_size}

      prior_pre_processor:  # Transformer inputs
        config:
          extra_inputs:
            direction_obs: ${algo.config.models.direction_model_for_transformer}

    critic:
      _target_: phys_anim.agents.models.critic.CriticMLP
      _recursive_: False
      config:
          initializer: default
          units: [1024, 1024, 1024]
          activation: relu
          normalize_obs: ${algo.config.normalize_obs}
          obs_clamp_value: ${algo.config.obs_clamp_value}
          use_layer_norm: False
          extra_inputs:
            direction_obs: ${algo.config.models.direction_model}

    extra_inputs:
      direction_obs:
        retrieve_from_env: True
        dtype: float
        size: ${algo.config.models.direction_model.num_in}